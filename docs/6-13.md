# 하나의 필드에 text와 keyword 타입을 동시에 사용하고 싶을 때 Multi Field
## ✅ 하나의 필드에 text와 keyword 타입을 동시에 사용하고 싶을 때 Multi Field
유연한 검색과 정확한 검색 둘 다 사용하고 싶은 경우가 있을 수 있다.
즉, `text` 타입과 `keyword` 타입을 동시에 사용하고 싶은 경우다.

* 문제 상황
```
DELETE /prodcuts

PUT /prodcuts
{
    "mappings": {
        "properties": {
            "name": {
                "type": "text",
                "analyzer": "nori"
            },
            "category": {
                "type": "text",
                "analyzer": "nori"
            }
        }
    }
}

POST /prodcuts/_doc
{
    "name": "삼성 세탁기",
    "category": "특수 가전제품"
}

// name, category를 활용해 유연하게 검색하고 싶을 때
GET /prodcuts/_search
{
    "query": {
        "multi_match": {
          "query": "가전",
          "fields": ["name", "category"]
        }
    }
}

// 특수 가전제품 카테고리의 상품만 검색하고 싶을 때
GET /prodcuts/_search
{
    "query": {
        "term": {
          "category": "특수 가전제품"
        }
    }
}

```

* 해결 방법(multi-fields 적용)
```
DELETE /prodcuts

PUT /prodcuts
{
    "mappings": {
        "properties": {
            "name": {
                "type": "text",
                "analyzer": "nori"
            },
            "category": {
                "type": "text",
                "analyzer": "nori",
                "fields": {
                    "raw": { // 서브 필드명(다른 이름으로 설정해도 됨)
                        "type": "keyword"
                    }
                }
            }
        }
    }
}

POST /prodcuts/_doc
{
    "name": "삼성 세탁기",
    "category": "특수 가전제품"
}

GET /prodcuts/_search
{
    "query": {
        "term": {
          "category.raw": "특수 가전제품"
        }
    }
}
```
* analyze api로 디버깅
```
GET /prodcuts/_analyze
{
    "field": "category",
    "text": "특수 가전제품"
}
GET /prodcuts/_analyze
{
    "field": "category.raw",
    "text": "특수 가전제품"
}
```