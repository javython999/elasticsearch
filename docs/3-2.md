# 역인덱스(inverted index)
## ✅ 역인덱스(inverted index)는 필드 값을 단어마다 쪼개서 찾기 쉽게 정리해놓은 목록이다.
1. 단어 단위로 자르기   
   * "name": "Apple 2025 맥북 에어 13 m4 10코어" -> [Apple, 2025, 맥북, 에어, 13, m4, 10코어]
   * "name": "Apple 2024 에어팟 4세대" -> [Apple, 2024, 에어팟, 4세대]
   * "name": "Apple 2024 아이패드 mini A17 Pro" -> [Apple, 2024, 아이패드, mini, A17, Pro]
2. 역인덱스로 저장
    
    | 토큰(token)|  도큐먼트 id|
    |:----------|:---------:|
    | Apple     | [1, 2, 3] |
    | 20205     |    [1]    |
    | 맥북       |    [1]    |
    | 에어       |    [1]    |
    | 13        |    [1]    |
    | m4        |    [1]    |
    | 10코어     |    [1]    |
    | 2024      |   [2,3]   |
    | 에어팟      |    [2]    |
    | 4세대      |    [2]    |
    | 아이패드    |    [3]    |
    | mini      |    [3]    |
    | A17       |    [3]    |
    | Pro       |    [3]    |
* 필드 값에서 추출돼 역인덱스에 저장된 단어를 토큰(token)이라고 부른다.
* 생성된 역인덱스를 직접 눈으로 확인할 수는 없다. 시스템 내부적으로 생성될 뿐이다.

3. 검색을 할 경우 역인덱스 활용
`Apple 2024 아이패드`라고 검색하면 역 인덱스를 활용해 일치하는 단어가 많은 도큐먼트를 우선적으로 조회한다.

   | 토큰(token)   |    도큐먼트 id    |
   |:------------|:-------------:|
   | **Apple**   | **[1, 2, 3]** |
   | 20205       |      [1]      |
   | 맥북         |      [1]      |
   | 에어         |      [1]      |
   | 13          |      [1]      |
   | m4          |      [1]      |
   | 10코어       |      [1]      |
   | **2024**    |   **[2,3]**   |
   | 에어팟        |      [2]      |
   | 4세대        |      [2]      |
   | **아이패드**  |    **[3]**    |
   | mini        |      [3]      |
   | A17         |      [3]      |
   | Pro         |      [3]      |

* id가 1인 도큐먼트: 단어 1개 일치
* id가 2인 도큐먼트: 단어 2개 일치
* id가 3인 도큐먼트: 단어 3개 일치

Elasticsearch의 자체적인 로직으로 score를 매겨 score가 높은 순(`id=3`, `id=2`, `id=1`)으로 도큐먼트를 조회한다.
검색어와 관련성이 높을 수록 score가 높게 측정 된다.

대략적인 score 계산 로직
* Term Frequency(TF)
  * 문서 내에서 얼마나 자주 등장하냐
* Inverse Document Frequency (IDF)
  * 검색어가 전체 문서 중 얼마나 희귀하냐
* Field Length Normalization
  * 문서(필드)가 짧을 수록 높은 점수

> Elasticsearch가 역인덱스(inverted index)의 기능을 가지고 있기 때문에, 단어의 순서랑 상관없이 도큐먼트를 조회 해올수 있는 것이다.

### 이런 작동 구조는 데이터 타입이 `text` 타입에 한해서만 적용 된다.